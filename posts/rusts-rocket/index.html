<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Rust's Rocket | Kurt Fehlhauer</title>
<meta name=keywords content><meta name=description content="The Rocket crate provides a lot of web server functionality that is simple to use. It compares well to other web-server backend libraries like Flask in Python. Currently, no Rust framework even registers on the Hacker Rank surveys of favorite web frameworks. That will change. Rocket is easy to use with great documentation and has over 21k stars on GitHub. This is a brief but detailed introduction to using Rocket, by the end of this post you should have a basic understanding of how to get, post, and put using Rocket."><meta name=author content><link rel=canonical href=https://kurtfehlhauer.com/posts/rusts-rocket/><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://kurtfehlhauer.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://kurtfehlhauer.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://kurtfehlhauer.com/favicon-32x32.png><link rel=apple-touch-icon href=https://kurtfehlhauer.com/apple-touch-icon.png><link rel=mask-icon href=https://kurtfehlhauer.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://kurtfehlhauer.com/posts/rusts-rocket/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Rust's Rocket"><meta property="og:description" content="The Rocket crate provides a lot of web server functionality that is simple to use. It compares well to other web-server backend libraries like Flask in Python. Currently, no Rust framework even registers on the Hacker Rank surveys of favorite web frameworks. That will change. Rocket is easy to use with great documentation and has over 21k stars on GitHub. This is a brief but detailed introduction to using Rocket, by the end of this post you should have a basic understanding of how to get, post, and put using Rocket."><meta property="og:type" content="article"><meta property="og:url" content="https://kurtfehlhauer.com/posts/rusts-rocket/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-05T07:03:52-04:00"><meta property="article:modified_time" content="2023-07-05T07:03:52-04:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Rust's Rocket"><meta name=twitter:description content="The Rocket crate provides a lot of web server functionality that is simple to use. It compares well to other web-server backend libraries like Flask in Python. Currently, no Rust framework even registers on the Hacker Rank surveys of favorite web frameworks. That will change. Rocket is easy to use with great documentation and has over 21k stars on GitHub. This is a brief but detailed introduction to using Rocket, by the end of this post you should have a basic understanding of how to get, post, and put using Rocket."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kurtfehlhauer.com/posts/"},{"@type":"ListItem","position":2,"name":"Rust's Rocket","item":"https://kurtfehlhauer.com/posts/rusts-rocket/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Rust's Rocket","name":"Rust\u0027s Rocket","description":"The Rocket crate provides a lot of web server functionality that is simple to use. It compares well to other web-server backend libraries like Flask in Python. Currently, no Rust framework even registers on the Hacker Rank surveys of favorite web frameworks. That will change. Rocket is easy to use with great documentation and has over 21k stars on GitHub. This is a brief but detailed introduction to using Rocket, by the end of this post you should have a basic understanding of how to get, post, and put using Rocket.","keywords":[],"articleBody":"The Rocket crate provides a lot of web server functionality that is simple to use. It compares well to other web-server backend libraries like Flask in Python. Currently, no Rust framework even registers on the Hacker Rank surveys of favorite web frameworks. That will change. Rocket is easy to use with great documentation and has over 21k stars on GitHub. This is a brief but detailed introduction to using Rocket, by the end of this post you should have a basic understanding of how to get, post, and put using Rocket.\nTo get started with Rocket you need to add it to your Cargo.toml file.\n[package] name = \"my-first-rocket\" version = \"0.1.0\" edition = \"2021\" [dependencies] rocket = \"0.5.0-rc.3\" Adding methods and routes to your main.rs file.\n#[macro_use] extern crate rocket; #[get(\"/\")] fn index() -\u003e \u0026'static str { \"Hello, world!\" } #[launch] fn rocket() -\u003e _ { rocket::build() .mount(\"/\", routes![index]) } Then run cargo run and enter http://127.0.0.1:8000/ into your browser. You should see “Hello, world!”.\nFor comparison, the Python example coded in Flask is comparable to the Rust version coded in Rocket.\nfrom flask import Flask app = Flask(__name__) @app.route(\"/\") def index(): return \"Hello World!\" if __name__ == \"__main__\": app.run() This is about the same amount of code as needed in Python’s Flask. With some extra code going towards specifying types and brackets. For a small investment in additional syntax, you gain all the benefits of type safety, no garbage collection, and not having to install Python’s runtimes to deploy this code. Creating and deploying the Rocket version is as simple as running cargo build --release and then copying the binary to the deployment location.\nThe get was pretty easy. Next, I will demonstrate the post and put to get a better understanding of what it is like to code using Rocket. This is where life gets a little more interesting. One of the selling points of Rust is “fearless concurrency” which is not even a thing in frameworks like Flask. Flask also has different goals than Rocket, it doesn’t pretend to be highly concurrent. Rocket like Rust wants to make use of all your CPU cores. That comes with the cost of learning how to write concurrent code in Rust.\nIn this demo, I will be replicating a database in a hashmap data structure using HashMap. However, since we need to make this thread safe it will need to be wrapped in a mutex and held in a Rocket State like this.\nuse rocket::tokio::sync::Mutex; use rocket::State; type DataHashMap = Mutex","wordCount":"2270","inLanguage":"en","datePublished":"2023-07-05T07:03:52-04:00","dateModified":"2023-07-05T07:03:52-04:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://kurtfehlhauer.com/posts/rusts-rocket/"},"publisher":{"@type":"Organization","name":"Kurt Fehlhauer","logo":{"@type":"ImageObject","url":"https://kurtfehlhauer.com/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://kurtfehlhauer.com/ accesskey=h title="Kurt Fehlhauer (Alt + H)">Kurt Fehlhauer</a><div class=logo-switches><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://kurtfehlhauer.com/photography/ title=Photography><span>Photography</span></a></li><li><a href=https://kurtfehlhauer.com/posts/ title=posts><span>posts</span></a></li><li><a href=https://kurtfehlhauer.com/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kurtfehlhauer.com/>Home</a>&nbsp;»&nbsp;<a href=https://kurtfehlhauer.com/posts/>Posts</a></div><h1 class=post-title>Rust's Rocket</h1><div class=post-meta>&lt;span title='2023-07-05 07:03:52 -0400 -0400'>July 5, 2023&lt;/span></div></header><div class=post-content><p>The <a href=https://rocket.rs>Rocket</a> <a href=https://crates.io/crates/rocket>crate</a> provides a lot of web server functionality that is simple to use. It compares well to other web-server backend libraries like <a href=https://flask.palletsprojects.com>Flask</a> in Python. Currently, no Rust framework even registers on the <a href="https://survey.stackoverflow.co/2023/?mod=djemCIO#section-most-popular-technologies-web-frameworks-and-technologies">Hacker Rank</a> surveys of favorite web frameworks. That will change. Rocket is easy to use with great documentation and has over 21k stars on GitHub. This is a brief but detailed introduction to using Rocket, by the end of this post you should have a basic understanding of how to get, post, and put using Rocket.</p><p>To get started with Rocket you need to add it to your <code>Cargo.toml</code> file.</p><pre tabindex=0><code class=language-[toml] data-lang=[toml]>[package]
name = &#34;my-first-rocket&#34;
version = &#34;0.1.0&#34;
edition = &#34;2021&#34;

[dependencies]
rocket = &#34;0.5.0-rc.3&#34;
</code></pre><p>Adding methods and routes to your <code>main.rs</code> file.</p><pre tabindex=0><code class=language-[rust] data-lang=[rust]>#[macro_use]
extern crate rocket;

#[get(&#34;/&#34;)]
fn index() -&gt; &amp;&#39;static str {
    &#34;Hello, world!&#34;
}

#[launch]
fn rocket() -&gt; _ {
    rocket::build()
        .mount(&#34;/&#34;, routes![index])
}
</code></pre><p>Then run <code>cargo run</code> and enter <code>http://127.0.0.1:8000/</code> into your browser. You should see &ldquo;Hello, world!&rdquo;.</p><p>For comparison, the Python example coded in Flask is comparable to the Rust version coded in Rocket.</p><pre tabindex=0><code class=language-[python] data-lang=[python]>from flask import Flask
app = Flask(__name__)

@app.route(&#34;/&#34;)
    def index():
        return &#34;Hello World!&#34;

if __name__ == &#34;__main__&#34;:
    app.run()
</code></pre><p>This is about the same amount of code as needed in Python&rsquo;s Flask. With some extra code going towards specifying types and brackets. For a small investment in additional syntax, you gain all the benefits of type safety, no garbage collection, and not having to install Python&rsquo;s runtimes to deploy this code. Creating and deploying the Rocket version is as simple as running <code>cargo build --release</code> and then copying the binary to the deployment location.</p><p>The <code>get</code> was pretty easy. Next, I will demonstrate the <code>post</code> and <code>put</code> to get a better understanding of what it is like to code using Rocket. This is where life gets a little more interesting. One of the selling points of Rust is <a href=https://doc.rust-lang.org/book/ch16-00-concurrency.html>&ldquo;fearless concurrency&rdquo;</a> which is not even a thing in frameworks like Flask. Flask also has different goals than Rocket, it doesn&rsquo;t pretend to be highly concurrent. Rocket like Rust wants to make use of all your CPU cores. That comes with the cost of learning how to write concurrent code in Rust.</p><p>In this demo, I will be replicating a database in a hashmap data structure using <code>HashMap&lt;u32, String></code>. However, since we need to make this thread safe it will need to be wrapped in a mutex and held in a Rocket State like this.</p><pre tabindex=0><code class=language-[rust] data-lang=[rust]>use rocket::tokio::sync::Mutex;
use rocket::State;

type DataHashMap = Mutex&lt;HashMap&lt;u32, String&gt;&gt;;
type Database&lt;&#39;r&gt; = &amp;&#39;r State&lt;DataHashMap&gt;;
</code></pre><p>The State reference requires a <a href=https://doc.rust-lang.org/book/ch10-03-lifetime-syntax.html>lifetime</a> which is what <code>&lt;'r></code> syntax represents.</p><p>So far we have only defined the types that make up the database. We have not instantiated it yet. Later, when we wire up the routes we will instantiate the hashmap and add it as a managed resource. This will make it available to functions using Rocket&rsquo;s annotations.</p><pre tabindex=0><code class=language-[rust] data-lang=[rust]>#[launch]
fn rocket() -&gt; _ {
    rocket::build()
        .mount(&#34;/&#34;, routes![index])
        .manage(DataHashMap::new(HashMap::new()))
}
</code></pre><p>JSON payloads tend to be ubiquitous on the Web whether it is for REST payloads or other purposes. In this post, we will examine two ways to represent deserialized JSON within a struct.
First, the obvious approach. It has the benefit of being easy to understand at the cost of constantly having to own the string when you need to modify the value. The entire point of using Rust is to be efficient, so this is not the most idiomatic approach.</p><pre tabindex=0><code class=language-[rust] data-lang=[rust]>use rocket::serde::{Deserialize, Serialize};

#[derive(Serialize, Deserialize)]
#[serde(crate = &#34;rocket::serde&#34;)]
struct Data {
    id: u32,
    value: String,
}
</code></pre><p>The more idiomatic approach is to use the Cow smart pointer since you don&rsquo;t have to think about if the value is just borrowed or owned. However, you will need to consider lifetimes in functions that use it. A small penalty to pay for the performance gain. However, depending on your use case. If your endpoint is under a light load, the additional memory spent may be worth it, but then you probably don&rsquo;t need Rust or Rocket either.</p><pre tabindex=0><code class=language-[rust] data-lang=[rust]>use rocket::serde::{Deserialize, Serialize};
use std::borrow::Cow;

#[derive(Serialize, Deserialize)]
#[serde(crate = &#34;rocket::serde&#34;)]
struct Data&lt;&#39;r&gt; {
    id: u32,
    value: Cow&lt;&#39;r, str&gt;,
}
</code></pre><p>First, I will implement the post, put, and get using non-reference versions of the struct.</p><pre tabindex=0><code class=language-[rust] data-lang=[rust]>#[post(&#34;/insert&#34;, format = &#34;json&#34;, data = &#34;&lt;data&gt;&#34;)]
async fn new(data: Json&lt;Data&gt;, database: Database&lt;&#39;_&gt;) -&gt; (Status, Value) {
    let mut db = database.lock().await;
    if db.contains_key(&amp;data.id) {
        return (
            Status::BadRequest,
            json!({ &#34;status&#34;: &#34;failed - record already exists&#34; }),
        );
    }

    db.insert(data.id, data.value.to_string());
    (Status::Accepted, json!({ &#34;status&#34;: &#34;ok&#34; }))
}

#[launch]
fn rocket() -&gt; _ {
    rocket::build()
        .mount(&#34;/&#34;, routes![new]) // Added the route for the &#34;new&#34; function
        .manage(DataHashMap::new(HashMap::new()))
}
</code></pre><p>The function <code>new</code> is annotated with the relative path, the format of the payload, JSON in this case and the variable that will hold the payload.</p><pre tabindex=0><code class=language-[rust] data-lang=[rust]>#[post(&#34;/insert&#34;, format = &#34;json&#34;, data = &#34;&lt;data&gt;&#34;)]
</code></pre><p>Since Rocket is designed to be concurrent we are going to use <code>async</code> functions. The function receives the JSON payload which is deserialized by Serde which is what <code>data: Json&lt;Data></code> does. The final argument passes in the database which is nothing more than a hashmap wrapped in a mutex that has its state managed by Rocket as declared earlier. The code <code>database: Database&lt;'_></code> may look odd, this is where we have to use lifetime notation to assist the Rust borrow checker because the type Database is a reference type. This ensures that the reference will remain valid through the life of the function call. The <code>&lt;'_></code> represents an anonymous lifetime. When you see &lt;&rsquo;_> in a type annotation or a function signature, it means that the reference has a specific, but unnamed, lifetime. The compiler will infer the actual lifetime based on the context where the reference is used. The function then returns a tuple of its status and a detailed message in a returned JSON payload.</p><pre tabindex=0><code class=language-[rust] data-lang=[rust]>async fn new(data: Json&lt;Data&gt;, database: Database&lt;&#39;_&gt;) -&gt; (Status, Value)
</code></pre><p>Since our database is wrapped in a mutex we must obtain a lock to it, so the state does not change while we attempt to retrieve a value for a given key in the hashmap. The code also checks for a unique key and does not allow duplicate entries for a given id.</p><pre tabindex=0><code class=language-[rust] data-lang=[rust]>let mut db = database.lock().await; // Get lock on the hashmap
    if db.contains_key(&amp;data.id) {  // Check for duplicate id!
        return (                    // If a duplicate return with approriate status message
            Status::BadRequest,
            json!({ &#34;status&#34;: &#34;failed - record already exists&#34; }),
        );
    }
</code></pre><p>Once we are sure we don&rsquo;t have a duplicate entry in our database we do the insert and return success results to the client.</p><pre tabindex=0><code class=language-[rust] data-lang=[rust]>db.insert(data.id, data.value.to_string());
    (Status::Accepted, json!({ &#34;status&#34;: &#34;ok&#34; }))
</code></pre><p>At this point, the complete working example.</p><pre tabindex=0><code class=language-[rust] data-lang=[rust]>use rocket::http::Status;
use rocket::serde::json::{json, Json, Value};
use rocket::serde::{Deserialize, Serialize};
use rocket::tokio::sync::Mutex;
use rocket::State;
use std::collections::HashMap;

#[macro_use]
extern crate rocket;

type DataHashMap = Mutex&lt;HashMap&lt;u32, String&gt;&gt;;
type Database&lt;&#39;r&gt; = &amp;&#39;r State&lt;DataHashMap&gt;;

#[derive(Serialize, Deserialize)]
#[serde(crate = &#34;rocket::serde&#34;)]
struct Data {
    id: u32,
    value: String,
}

#[post(&#34;/insert&#34;, format = &#34;json&#34;, data = &#34;&lt;data&gt;&#34;)]
async fn new(data: Json&lt;Data&gt;, database: Database&lt;&#39;_&gt;) -&gt; (Status, Value) {
    let mut db = database.lock().await;
    if db.contains_key(&amp;data.id) {
        return (
            Status::BadRequest,
            json!({ &#34;status&#34;: &#34;failed - record already exists&#34; }),
        );
    }

    db.insert(data.id, data.value.to_string());
    (Status::Accepted, json!({ &#34;status&#34;: &#34;ok&#34; }))
}

#[launch]
fn rocket() -&gt; _ {
    rocket::build()
        .mount(&#34;/&#34;, routes![new])
        .manage(DataHashMap::new(HashMap::new()))
}
</code></pre><p>To retrieve the data stored we need to implement the <code>get</code> function and add its route to the <code>mount</code>. Also, notice the use of pattern matching which makes the code more compact and easier to comprehend.</p><pre tabindex=0><code class=language-[rust] data-lang=[rust]>#[get(&#34;/getdata/&lt;id&gt;&#34;)]
async fn get_my_data(id: u32, database: Database&lt;&#39;_&gt;) -&gt; (Status, Value) {
    match database.lock().await.get(&amp;id) {
        Some(d) =&gt; (Status::Accepted, json!({ &#34;status&#34;: &#34;ok&#34;, &#34;data&#34;: d })),
        None =&gt; (
            Status::BadRequest,
            json!({ &#34;status&#34;: &#34;failed - no data found&#34;}),
        ),
    }
}

#[launch]
fn rocket() -&gt; _ {
    rocket::build()
        .mount(&#34;/&#34;, routes![get_my_data, new])
        .manage(DataHashMap::new(HashMap::new()))
}
</code></pre><p>Now we can insert data and return data. Using the VS Code plugin <a href="https://marketplace.visualstudio.com/items?itemName=humao.rest-client">Rest Client</a></p><pre tabindex=0><code>POST http://127.0.0.1:8000/insert HTTP/1.1
content-type: application/json

{
    &#34;id&#34;: 1,
    &#34;value&#34;: &#34;NEW DATA&#34;
}
</code></pre><p>To get the data back, in a browser enter <code>http://127.0.0.1:8000/getdata/1</code> or use the Rest Client.</p><pre tabindex=0><code>GET http://127.0.0.1:8000/getdata/1 HTTP/1.1
</code></pre><p>The results are:</p><pre tabindex=0><code>HTTP/1.1 202 Accepted
content-type: application/json
server: Rocket
x-content-type-options: nosniff
x-frame-options: SAMEORIGIN
permissions-policy: interest-cohort=()
content-length: 15
date: Tue, 04 Jul 2023 12:58:05 GMT

{
  &#34;status&#34;: &#34;ok&#34;
}
</code></pre><p>The update function using a <code>put</code> will be more of the same.</p><pre tabindex=0><code class=language-[rust] data-lang=[rust]>#[put(&#34;/update&#34;, format = &#34;json&#34;, data = &#34;&lt;data&gt;&#34;)]
async fn update(data: Json&lt;Data&gt;, database: Database&lt;&#39;_&gt;) -&gt; (Status, Value) {
    match database.lock().await.get_mut(&amp;data.id) {
        Some(d) =&gt; {
            *d = data.value.to_string();
            (Status::Accepted, json!({ &#34;status&#34;: &#34;ok&#34; }))
        }
        None =&gt; {
            let status = format!(
                &#34;failed - record does not exist for {}&#34;,
                &amp;data.id.to_string()
            );
            (Status::BadRequest, json!({ &#34;status&#34;: status }))
        }
    }
}

#[launch]
fn rocket() -&gt; _ {
    rocket::build()
        .mount(&#34;/&#34;, routes![get_my_data, new, update])
        .manage(DataHashMap::new(HashMap::new()))
}
</code></pre><p>The complete example.</p><pre tabindex=0><code class=language-[rust] data-lang=[rust]>use rocket::http::Status;
use rocket::serde::json::{json, Json, Value};
use rocket::serde::{Deserialize, Serialize};
use rocket::tokio::sync::Mutex;
use rocket::State;
use std::collections::HashMap;

#[macro_use]
extern crate rocket;

type DataHashMap = Mutex&lt;HashMap&lt;u32, String&gt;&gt;;
type Database&lt;&#39;r&gt; = &amp;&#39;r State&lt;DataHashMap&gt;;

#[derive(Serialize, Deserialize)]
#[serde(crate = &#34;rocket::serde&#34;)]
struct Data {
    id: u32,
    value: String,
}

#[post(&#34;/insert&#34;, format = &#34;json&#34;, data = &#34;&lt;data&gt;&#34;)]
async fn new(data: Json&lt;Data&gt;, database: Database&lt;&#39;_&gt;) -&gt; (Status, Value) {
    let mut db = database.lock().await;
    if db.contains_key(&amp;data.id) {
        return (
            Status::BadRequest,
            json!({ &#34;status&#34;: &#34;failed - record already exists&#34; }),
        );
    }

    db.insert(data.id, data.value.to_string());
    (Status::Accepted, json!({ &#34;status&#34;: &#34;ok&#34; }))
}

#[put(&#34;/update&#34;, format = &#34;json&#34;, data = &#34;&lt;data&gt;&#34;)]
async fn update(data: Json&lt;Data&gt;, database: Database&lt;&#39;_&gt;) -&gt; (Status, Value) {
    match database.lock().await.get_mut(&amp;data.id) {
        Some(d) =&gt; {
            *d = data.value.to_string();
            (Status::Accepted, json!({ &#34;status&#34;: &#34;ok&#34; }))
        }
        None =&gt; {
            let status = format!(
                &#34;failed - record does not exist for {}&#34;,
                &amp;data.id.to_string()
            );
            (Status::BadRequest, json!({ &#34;status&#34;: status }))
        }
    }
}

#[get(&#34;/getdata/&lt;id&gt;&#34;)]
async fn get_my_data(id: u32, database: Database&lt;&#39;_&gt;) -&gt; (Status, Value) {
    match database.lock().await.get(&amp;id) {
        Some(d) =&gt; (Status::Accepted, json!({ &#34;status&#34;: &#34;ok&#34;, &#34;data&#34;: d })),
        None =&gt; (
            Status::BadRequest,
            json!({ &#34;status&#34;: &#34;failed - no data found&#34;}),
        ),
    }
}

#[launch]
fn rocket() -&gt; _ {
    rocket::build()
        .mount(&#34;/&#34;, routes![get_my_data, new, update])
        .manage(DataHashMap::new(HashMap::new()))
}
</code></pre><p>Next, let&rsquo;s refactor this code to make it more idiomatic Rust. We will replace:</p><pre tabindex=0><code class=language-[rust] data-lang=[rust]>#[derive(Serialize, Deserialize)]
#[serde(crate = &#34;rocket::serde&#34;)]
struct Data {
    id: u32,
    value: String,
}
</code></pre><p>with</p><pre tabindex=0><code class=language-[rust] data-lang=[rust]>use rocket::serde::{Deserialize, Serialize};
use std::borrow::Cow;

#[derive(Serialize, Deserialize)]
#[serde(crate = &#34;rocket::serde&#34;)]
struct Data&lt;&#39;r&gt; {
    id: u32,
    value: Cow&lt;&#39;r, str&gt;,
}
</code></pre><p>The <code>post</code> will also be refactored to use pattern matching.</p><pre tabindex=0><code class=language-[rust] data-lang=[rust]>use rocket::http::Status;
use rocket::serde::json::{json, Json, Value};
use rocket::serde::{Deserialize, Serialize};
use rocket::tokio::sync::Mutex;
use rocket::State;
use std::borrow::Cow;
use std::collections::HashMap;

#[macro_use]
extern crate rocket;

type DataHashMap = Mutex&lt;HashMap&lt;u32, String&gt;&gt;;
type Database&lt;&#39;r&gt; = &amp;&#39;r State&lt;DataHashMap&gt;;

#[derive(Serialize, Deserialize)]
#[serde(crate = &#34;rocket::serde&#34;)]
struct Data&lt;&#39;r&gt; {
    id: u32,
    value: Cow&lt;&#39;r, str&gt;,
}

#[post(&#34;/insert&#34;, format = &#34;json&#34;, data = &#34;&lt;data&gt;&#34;)]
async fn new(data: Json&lt;Data&lt;&#39;_&gt;&gt;, database: Database&lt;&#39;_&gt;) -&gt; (Status, Value) {
    let mut db = database.lock().await;

    match db.contains_key(&amp;data.id) {
        false =&gt; {
            db.insert(data.id, data.value.to_string());
            (Status::Accepted, json!({ &#34;status&#34;: &#34;ok&#34; }))
        }
        true =&gt; (
            Status::BadRequest,
            json!({ &#34;status&#34;: &#34;failed - record already exists&#34; }),
        ),
    }
}

#[put(&#34;/update&#34;, format = &#34;json&#34;, data = &#34;&lt;data&gt;&#34;)]
async fn update(data: Json&lt;Data&lt;&#39;_&gt;&gt;, database: Database&lt;&#39;_&gt;) -&gt; (Status, Value) {
    match database.lock().await.get_mut(&amp;data.id) {
        Some(d) =&gt; {
            *d = data.value.to_string();
            (Status::Accepted, json!({ &#34;status&#34;: &#34;ok&#34; }))
        }
        None =&gt; {
            let status = format!(
                &#34;failed - record does not exist for {}&#34;,
                &amp;data.id.to_string()
            );
            (Status::BadRequest, json!({ &#34;status&#34;: status }))
        }
    }
}

#[get(&#34;/getdata/&lt;id&gt;&#34;)]
async fn get_my_data(id: u32, database: Database&lt;&#39;_&gt;) -&gt; (Status, Value) {
    match database.lock().await.get(&amp;id) {
        Some(d) =&gt; (Status::Accepted, json!({ &#34;status&#34;: &#34;ok&#34;, &#34;data&#34;: d })),
        None =&gt; (
            Status::BadRequest,
            json!({ &#34;status&#34;: &#34;failed - no data found&#34;}),
        ),
    }
}

#[launch]
fn rocket() -&gt; _ {
    rocket::build()
        .mount(&#34;/&#34;, routes![get_my_data, new, update])
        .manage(DataHashMap::new(HashMap::new()))
}
</code></pre><p>In the final refactored version we now take advantage of smart pointers, however, now we need to deal with more lifetimes.</p><pre tabindex=0><code class=language-[rust] data-lang=[rust]>async fn new(data: Json&lt;Data&lt;&#39;_&gt;&gt;, database: Database&lt;&#39;_&gt;) -&gt; (Status, Value) // data: Json&lt;Data&lt;&#39;_&gt;&gt; has lifetime notation
async fn update(data: Json&lt;Data&lt;&#39;_&gt;&gt;, database: Database&lt;&#39;_&gt;) -&gt; (Status, Value) // data: Json&lt;Data&lt;&#39;_&gt;&gt; has lifetime notation
</code></pre><h3 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h3><p>Rocket is simple and it shares a lot in common with other libraries for different languages. Becoming productive in Rust is possible once you overcome the learning curve of the borrow checker and learn some concurrent programming skills. If you already have those skills, using Rocket is just as simple as using frameworks in more dynamic languages. Also, does not take six months to become proficient in Rust, you can become productive in <a href=https://opensource.googleblog.com/2023/06/rust-fact-vs-fiction-5-insights-from-googles-rust-journey-2022.html>two months</a>.</p><p>Rust&rsquo;s ecosystem for web development is growing. It doesn&rsquo;t have complete batteries-included (opinionated) frameworks like Django but that also mirrors the Rust standard runtime which is not prescriptive and encourages the use of the crates that meet your needs. Rocket is one of many frameworks under active development such as <a href=https://actix.rs/>Actix Web</a> and Axum(<a href=https://github.com/tokio-rs/axum)>https://github.com/tokio-rs/axum)</a>. The <a href=https://www.arewewebyet.org/>&ldquo;Are we web yet?&rdquo;</a> is a great resource for learning about the state of web development in Rust.</p><h3 id=other-thoughts>Other thoughts<a hidden class=anchor aria-hidden=true href=#other-thoughts>#</a></h3><p>While not readily apparent from this intro to Rocket, managing memory as efficiently as possible will have an impact on performance and cost. Does it matter? It depends on your company&rsquo;s goals and what its values are. Most companies don&rsquo;t care about writing efficient code for the sake of writing efficient code. Most companies value developer productivity more than server costs which is why garbage-collected languages like Python, Go, and Java remain popular. For that class of company, sticking with Python, Javascript, etc. will serve them well. On the other side of the spectrum are a class of companies where scaling out has significant impacts on costs or in some cases all out performance matters to them. Making use of all your cores in Rust is a much lower-risk activity compared to C/C++. A real-world example of this was Cloudflare&rsquo;s rewriting of an <a href=https://blog.cloudflare.com/rust-nginx-module/>NGINX module in Rust</a>.</p><p><a href=https://github.com/kfehlhauer/my-first-rocket/tree/main>The source code can be found here.</a></p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=https://kurtfehlhauer.com/posts/exploring-rust-for-data-engineering-part-1/><span class=title>Next »</span><br><span>Exploring Rust For Data Engineering Part 1</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Rust's Rocket on twitter" href="https://twitter.com/intent/tweet/?text=Rust%27s%20Rocket&amp;url=https%3a%2f%2fkurtfehlhauer.com%2fposts%2frusts-rocket%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Rust's Rocket on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fkurtfehlhauer.com%2fposts%2frusts-rocket%2f&amp;title=Rust%27s%20Rocket&amp;summary=Rust%27s%20Rocket&amp;source=https%3a%2f%2fkurtfehlhauer.com%2fposts%2frusts-rocket%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Rust's Rocket on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fkurtfehlhauer.com%2fposts%2frusts-rocket%2f&title=Rust%27s%20Rocket"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Rust's Rocket on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fkurtfehlhauer.com%2fposts%2frusts-rocket%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Rust's Rocket on whatsapp" href="https://api.whatsapp.com/send?text=Rust%27s%20Rocket%20-%20https%3a%2f%2fkurtfehlhauer.com%2fposts%2frusts-rocket%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Rust's Rocket on telegram" href="https://telegram.me/share/url?text=Rust%27s%20Rocket&amp;url=https%3a%2f%2fkurtfehlhauer.com%2fposts%2frusts-rocket%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://kurtfehlhauer.com/>Kurt Fehlhauer</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>